let listTable,url="",currentUrl="";const loadDatatable=function(e,t,a){let o={};!1===_.isUndefined(t)&&(o.filters=t),!1===_.isUndefined(a)&&(o.take=a),axios.get(e,{params:o,onUploadProgress:function(e){$("#overlayLoader").show()}}).then((e=>{let t=e.data,a=t.paginated.data;if(listTable.bootstrapTable("load",a),!1===_.isUndefined(t.links)){let e=t.links,a=_.template(e)();$("#datatable-pagination").html(a)}!1===_.isUndefined(t.currentUrl)&&(currentUrl=t.currentUrl)})).catch((e=>{})).finally((()=>{$("#overlayLoader").hide()}))},flashMessage=function(){let e=cookies.get("flash-message"),t=cookies.get("flash-status");!1===_.isUndefined(e)&&!1===_.isNull(e)&&(Toast.fire({icon:t,title:e}),cookies.del("flash-message"),cookies.del("flash-status"))},commitPost=function(e){let t=e.attr("action");!1===_.isUndefined(t)&&(e.find(".form-control,.form-control-plaintext").removeClass("is-invalid").addClass("is-valid"),$(".invalid-feedback").hide(),fireRequest(e,t))},onImageUpload=async function(e,t){let a=new FormData;a.append("image",e,e.name),await axios({url:route("editor.upload_image"),method:"POST",data:a}).then((e=>{let a=e.data.url;t.summernote("insertImage",a)})).catch((e=>{console.error(e)}))},previewImage=function(e){let t=e.get(0),a=e.closest(".form-group").find(".row").find(".img-preview").find(".row").empty();if(t.files){var o=t.files.length;for(i=0;i<o;i++){var n=new FileReader;n.onload=function(e){$($.parseHTML('<div class="col-2"><img src="'+e.target.result+'" class="img-thumbnail"></div>')).appendTo(a)},n.readAsDataURL(t.files[i])}}},fireRequest=function(e,t){axios.request({method:"POST",url:t,data:new FormData(e[0]),headers:{"Content-Type":"multipart/form-data","X-Requested-With":"XMLHttpRequest"},onUploadProgress:function(e){$("#overlayLoader").show()}}).then((e=>{let t=e.data;t.hasOwnProperty("flash")&&_.isString(t.flash)&&(cookies.set("flash-status",t.status),cookies.set("flash-message",t.flash)),t.hasOwnProperty("redirect")&&t.redirect&&$(location).attr("href",t.redirect),t.hasOwnProperty("reload")&&t.reload&&location.reload(),t.hasOwnProperty("relist")&&t.relist&&(flashMessage(),loadDatatable(currentUrl))})).catch((e=>{let t=e.response.data,a=t.errors;t.message;_.forEach(a,(function(e,t){$("[name="+t+"]").addClass("is-invalid"),$("#"+t+"-alert").html(_.join(e,"<br>")).show()})),Toast.fire({icon:"error",title:"Opps! Something went wrong!"})})).finally((()=>{$("#overlayLoader").hide()}))},webPush=function(e,t,a,o,i){Push.create(e,{body:t,icon:a,link:o,timeout:i,onClick:function(){window.focus(),this.close()}})},toastPush=function(e,t,a,o,i){Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:i,timerProgressBar:!0,didOpen:e=>{e.addEventListener("mouseenter",Swal.stopTimer),e.addEventListener("mouseleave",Swal.resumeTimer)}}).fire({icon:"success",title:e,html:t})};$(document).ready((function(){_.attempt(flashMessage),$("#overlayLoader").hide(),!1===_.isUndefined(url)&&(listTable=$(".bootstrap-table").bootstrapTable({onReorderRow:e=>{let t=[];_.forEach(e,(function(e,a){t.push(e.id)})),$("#newRow").val(t.join(",")),$("form[data-ajax-form]").trigger("submit")}}),_.attempt(loadDatatable,url)),$(document).on("click",".page-link",(function(e){if("datatable-pagination"==$(this).closest("div").attr("id")){e.preventDefault();let t=$(this).attr("href");loadDatatable(t)}})),$(document).on("change","#pageTake",(function(e){e.preventDefault();let t={};t.filter=$(".filterInput").serialize(),loadDatatable(currentUrl,t,$(this).val())})),$(document).on("submit","form[data-ajax-form]",(function(e){e.preventDefault();let t=$(this),a=t.data("confirm");!1===_.isUndefined(a)?Swal.fire({title:"Are you sure?",text:a,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, please!"}).then((e=>{e.value&&commitPost(t)})):commitPost(t)})),$(document).on("click","#filterBtn",(function(e){e.preventDefault();let t={};t.filter=$(".filterInput").serialize(),loadDatatable(url,t),$("#filterModalCenter").modal("hide")})),$(".selectpicker").selectpicker()}));
